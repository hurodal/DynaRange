C:\>rango

Digital camera Dynamic Range calculation "rango" v1.0
by Juan Manuel Font (coding), Hugo Rodriguez (UI design) and Guillermo Luijk (algorithms)

Usage: rango [OPTION]... [FILE]...

--chart               -c <DIMX W H M N>    : Create test chart in PNG format ("testchart.png") with a specific resolution, format and number of patches (default DIMX=1920, W=3, H=2, M=4, N=6)
--chart-colour        -C <R G B invgamma>  : Create test chart in PNG format ("testchart.png") ranging colours from (0,0,0) to (R,G,B) with gamma compression (default R=255, G=101, B=164, invgamma=1.4)
--chart-patches       -M <M N>             : Read test chart decoding MxN patches over rows (M) and columns (N) (default M=4, N=6)
--chart-coords        -x <x1 y1 x2 y2 x3 y3 x4 y4> : Read test chart defined by 4 corners (no specific ordering needed): (x1,y1), (x2,y2), (x3,y3), (x4,y4), being (0,0) the coordinates of the top-left pixel
--black-file          -b <file>            : Totally dark RAW file ideally shot at base ISO
--black-level         -B <float>           : Camera RAW black level
--saturation-file     -s <file>            : Totally clipped RAW file ideally shot at base ISO
--saturation-level    -S <float>           : Camera RAW saturation level
--input-files         -i <files>           : Input RAW files shot over the test chart ideally for every ISO
--patch-ratio         -r <float>           : Relative patch width/height used to compute signal and noise readings (default=0.5)
--snrthreshold-db     -d <float list>      : SNR threshold(s) list in dB for DR calculation (default=0 12 being 0dB="Engineering DR" and 12dB="Photographic DR")
--drnormalization-mpx -m <float>           : Number of Mpx for DR normalization (default=8Mpx, no normalization=per pixel DR=0Mpx)
--raw-channels        -w <R G1 G2 B AVG>   : Specify with 0/1 boolean values for which RAW channel(s) the calculations (SNR curves, DR) will be carried out (default=0 0 0 0 1)
--poly-fit            -f <int 2-3>         : Polynomic order to fit the SNR curve (default=3)
--output-file         -o <file>            : Output CSV text file(s) with all results: black level, sat level, SNR samples, DR values, fitting params (default="results.csv")
--plot-format         -p <PNG/SVG>         : Export SNR curves plot in PNG/SVG format (default format=PNG)
--plot-params         -P <S C L> <int 1-3> : Export SNR curves with SCL 1-3 info (default=1 1 1 3)
--print-patches       -g <file>            : Save keystone/ETTR/gamma corrected test chart in PNG format indicating the grid of patches used for all calculations (default="printpatches.png")


-----------------------------------------------

--chart -c <DIMX W H M N>
Definition: create test chart in PNG format ("testchart.png") with a specific resolution, format and number of patches (default DIMX=1920, W=3, H=2, M=4, N=6)
--chart-colour -C <R G B invgamma>
Definition: create test chart in PNG format ("testchart.png") ranging colours from (0,0,0) to (R,G,B) with gamma compression (default R=255, G=101, B=164, invgamma=1.4)
Explanation: these options allow to create a test chart ("magentachart.png") with patches exactly as rango will expect them to be located. This chart needs to be shot using the camera under test following precise focusing and exposure instructions
Usage: if absolutely no chart parameters are specified, ALL the chart creation default values will be used to produce an optimized test chart in most standard displays
Examples (first example is default and is equivalent to not specifying the parameter):
--chart -c                        (output the default standard magenta patches chart)
--chart -c 800 4 3                (create a 800 pixels width test chart for M4/3 cameras)
--chart -c 800 4 3 2 5            (create a 800 pixels width test chart for M4/3 cameras with 2 rows and 5 columns of patches)
--chart-colour -C 128 128 128 1.4 (create a soft grayscale test chart)

--chart-patches -M <M N>  
Definition: read test chart decoding MxN patches over rows (M) and columns (N) (default M=4, N=6)
--chart-coords -x <x1 y1 x2 y2 x3 y3 x4 y4>
Definition: read test chart defined by 4 corners (no specific ordering needed): (x1,y1), (x2,y2), (x3,y3), (x4,y4), being (0,0) the coordinates of the top-left pixel
Explanation: read patches on an arbitrarily sized or positioned test chart when automatic corner detection fails or cannot be used, or a specific number of patches were used
Examples:
--chart-patches -M 8 12 (decode a very dense 8x12 patches test chart)
--chart-coords  -x 1 1 1 4000 6000 4000 6000 1 (decode a test chart occupying the entire frame on a 24 Mpx camera)

--black-file  -b <file>
--black-level -B <float>
Definition: camera RAW black level / totally dark RAW file ideally shot at base ISO (default=black level power of 2 estimation)
Explanation: setting this parameter is optional but it is VERY recommended since all SNR calculations are very sensitive to it. Knowing the black level is mandatory to linearize all sensor data by subtracting it from the RAW values in order to obtain accurate DR measurements
Usage: the most reliable way to proceed is to capture a quick darkframe at base ISO ideally with the camera still cold (-B option). There is also a possibility of providing the parameter if you feel confident enough of your camera's precise black level (-b option). If none of the options are used, rango by default will calculate the lowest power of 2 value where information is found which can be risky
Examples (first example is default and is equivalent to not specifying the parameter):
--black-file  -b
--black-file  -b black.dng (provide a darkframe RAW file so that rango calculates the black level)
--black-level -B 255       (provide a black level of 255 for the Olympus OM-1)
--black-level -B 254.85    (provide a more precise black level of 254.85 for the Olympus OM-1)

--saturation-file  -s <file>
--saturation-level -S <float>
Definition: camera RAW saturation level / totally clipped RAW file ideally shot at base ISO (default=saturation level bitdepth scale estimation)
Explanation: not being as critical as the black level, setting this parameter is also very important to properly locate exposure values with respect to saturation in order to obtain accurate DR measurements
Usage: the most reliable way to proceed is to capture a completely clipped RAW file ideally at base ISO (-S option). There is also a possibility of providing the parameter if you feel confident enough of your camera's precise saturation level (-s option). If none of the options are used, rango by default will calculate the end of the bitdepth scale from the highest ISO RAW file
Examples (first example is default and is equivalent to not specifying the parameter):
--saturation-file  -s
--saturation-file  -s sat.dng (provide a 100% clipped RAW file to calculate the saturation level)
--saturation-level -S 3692    (provide a saturation level of 3692 for the Canon 5D)
--saturation-level -S 16383   (provide a saturation level of 16383 for the Sony A7 II)

--input-files -i <files>
Definition: input RAW files shot over the test chart ideally for every ISO (no default, mandatory parameter)
Explanation: this is the command to input all the RAW files the user obtained by shooting the test chart, ideally at every ISO. An SNR curve will be calculated for each file, from which the requested DR values are derived
Usage: the user must supply a list of RAW filenames or a wildcard pattern that represents them
--input-files -i iso100.dng iso200.dng iso3200.dng (provide a list of RAW files to process)
--input-files -i *.arw                             (provide a wildcard for a list of Sony RAW files)

--patch-ratio -r <float>
Definition: relative patch width/height used to compute signal and noise readings (default=0.5)
Explanation: contamination on signal and noise readings, specially from chart blur and lens distortion, but also from screen reflections or lens vigneting, will lead to artificially increase noise measurements and hence lowering SNR values and estimated DR. To minimize this the effective area of each patch that will be used can be set: 0.5 means we're using 50% of centred patch width/height, so we're using 25% of the total chart area. Lower values will be more robust vs chart lighting non uniformity, while higher values will collect more samples providing higher statistical robustness
Usage: by default 50% of each patch width/height centred is used. You may set any value between 0 and 1 but values far from 0.5 are not recommended
Examples (first example is default and is equivalent to not specifying the parameter):
--patch-ratio -r     (50% of patch width/height centred will be used, 25% of patch area)
--patch-ratio -r 0.5 (50% of patch width/height centred will be used, 25% of patch area)
--patch-ratio -r 0.6 (60% of patch width/height centred will be used, 36% of patch area)

--snrthreshold-db -d <float list>
Definition: SNR threshold(s) list in dB for DR calculation (default=0 12 being 0dB="Engineering DR" and 12dB="Photographic DR")
Explanation: to determine the DR, a SNR threshold must be defined. The DR according to that criteria will be the number of stops between sensor saturation and the point at which the SNR curve falls to the specified SNR threshold. This means each threshold will yield different DR values, and they will all be correct according to that criteria
Usage: by default the DR for both 12dB and 0dB DR values is calculated. If specified, the listed SNR thresholds will be used
Examples (first example is default and is equivalent to not specifying the parameter):
--snrthreshold-db -d        (0dB and 12dB thresholds are used)
--snrthreshold-db -d 0      (only 0dB threshold is used)
--snrthreshold-db -d 12     (only 12dB threshold is used)
--snrthreshold-db -d 0 6 12 (0dB, 6dB and 12dB thresholds are used)

--drnormalization-mpx -m <float>
Definition: number of Mpx for DR normalization (default=8Mpx, no normalization=per pixel DR=0Mpx)
Explanation: in order to properly and fairly compare different resolution cameras, the SNR values need to be normalized to a given output resolution before calculating the DR. This means DR figures will vary according to this resolution normalization, obtaining higher values the lower the number of Mpx specified
Usage: by default a 8Mpx based DR is calculated. If no normalization is wanted (per-pixel DR) a value of 0 must be set for this parameter
Examples (first example is default and is equivalent to not specifying the parameter):
--drnormalization-mpx .m      (DR normalized to 8Mpx)
--drnormalization-mpx -m 21.5 (DR normalized to 21.5Mpx)
--drnormalization-mpx -m 0    (no normalization, per-pixel DR)

--raw-channels -w <R G1 G2 B AVG>
Definition: specify with 0/1 boolean values for which RAW channel(s) the calculations (SNR curves, DR) will be carried out (default=0 0 0 0 1)
Explanation: Bayer image sensors consist of 4 RAW channels (R, G1, G2, B) following a 2x2 colour filter array. Nothing states these 4 channels will have the same performance. This command allows to separately calculate the scatterplot, SNR curves and DR values for each channel to find out. The corresponding differentiated colour will be used in the plots for each channel
Usage: R G1 G2 B are boolean 0/1 values indicating whether every single channel will be analysed. AVG on the contrary allows 3 values: 0=no averaging, 1=average all 4 RAW channels, irrespectively if they were requested or not, 2=average only the requested RAW channels. The most obvious and standard usage of this command is to perform the average (AVG) of all 4 RAW channels, so all of them are equally taken into account. For any other specific analysis this command can be used
Examples (first example is default and is equivalent to not specifying the parameter):
--raw-channel -w           (average 4 RAW channels)
--raw-channel -w 0 0 0 0 1 (average 4 RAW channels)
--raw-channel -w 1 1 0 1 0 (study pure RGB performance assuming G1 and G2 are equal and ignoring G2)
--raw-channel -w 0 0 0 1 0 (focus on studying the B channel)
--raw-channel -w 0 1 1 0 0 (study G1/G2 channels imbalancing)
--raw-channel -w 0 1 1 0 2 (study G1/G2 channels imbalancing including their average)

--poly-fit -f <int 2-3>
Definition: Polynomic order to fit the SNR curve (default=3)
Explanation: the gathered (exposure, SNR) pairs need to be fitted to estimate the SNR curves. This is done through polynomial least squares fitting. For the problem under study, SNR on a digital image sensor, we found that 3rd order curves are in general preferred for increased accuracy while 2nd order are less prone to overfitting
Usage: by default 3rd order (cubic) curves will be used to approximate the SNR response. The alternative is using 2nd order (cuadratic) curves
Examples (first example is default and is equivalent to not specifying the parameter):
--poly-fit -f   (3rd order curves are used to fit the SNR curves)
--poly-fit -f 2 (2nd order curves are used to fit the SNR curves)
--poly-fit -f 3 (3rd order curves are used to fit the SNR curves)

--output-file -o <file>
Definition: output CSV text file(s) with all results: black level, sat level, SNR samples, DR values, fitting params (default="results.csv")
Explanation: in a CSV text file chosen by the user all the relevant variables will be output: black level, sat level, SNR samples, DR values, fitting params
Usage: by default the data will be output on a "results.csv" file, which the user can change at convenience
Examples (first example is default and is equivalent to not specifying the parameter):
--output-file -o                    (output results to "results.csv")
--output-file -o results_ep5.csv    (output results to "results_ep5.csv")
--output-file -o results_sonya7.csv (output results to "results_sonya7.csv")

--plot-format -p <PNG/SVG>
Definition: export SNR curves plot in PNG/SVG format (default format=PNG)
Explanation: the SNR curves show the SNR in dB achieved for every exposure value in EV with respect to saturation (0EV). They are the best way to display the performance of the sensor in the whole exposure range analysed (deep shadows).
Usage: a PNG/SVG file will be saved. The format can be specified (PNG is a bitmap format while SVG is a vector formats)
Examples (first example is default and is equivalent to not specifying the parameter):
--plot-format -p     (plot export of SNR curves in PNG format in "snrcurves.png" with additional info)
--plot-format -p PNG (plot export of SNR curves in PNG format in "snrcurves.png" with additional info)
--plot-format -p SVG (plot export of SNR curves in SVG format in "snrcurves.png" with additional info)

--plot-params -P <S C L> <int 1-3>
Definition: export SNR curves plot in PNG/SVG format (default=1 1 1 3)
Explanation: the SNR curves show the SNR in dB achieved for every exposure value in EV with respect to saturation (0EV). They are the best way to display the performance of the sensor in the whole exposure range analysed (deep shadows).
Usage: the information included in the plots can be taylored with 3 boolean values: S-catter C-urves L-abels, plus a 1-3 integer parameter: 1 will export the SNR curves alone, 2 and 3 will add the specific CLI commmand (no file names) that generated the curves in short (2) or long (3) versions
Examples (first example is default and is equivalent to not specifying the parameter):
--plot-params -P         (default parameters 1 1 1 3 are used)
--plot-params -P 1 1 1 1 (plot export of SNR curves without CLI command)
--plot-params -P 1 1 1 2 (plot export of SNR curves adding short CLI command)
--plot-params -P 1 1 1 3 (plot export of SNR curves adding long CLI command)
--plot-params -P 0 1 0 1 (plot export of SNR curves with minimalistic appearance)

--print-patches -g <file>
Definition: save keystone/ETTR/gamma corrected test chart in PNG format indicating the grid of patches used for all calculations (default="printpatches.png")
Explanation: to make sure patches are correctly being read from the test chart without taking data from neighbour patches, this function will create a keystone corrected and ETTR/gamma normalized image of the test chart, indicating the location and shape of all patches used. The lowest ISO/G1 RAW channel will be used
Usage: the user can additionally supply a output name for the PNG file
Examples (first example is default and is equivalent to not specifying the parameter):
--print-patches -g                     (display used patches in "printpatches.png") 
--print-patches -g patch_debugging.png (display used patches in "patch_debugging.png") 
































